<!DOCTYPE html> <html lang=en style><!--
 Page saved with SingleFile 
 url: https://ianthehenry.com/posts/how-to-learn-nix/profiles/ 
 saved date: Mon Jul 17 2023 13:34:59 GMT+0600 (Kyrgyzstan Time)
--><meta charset=utf-8>
<meta name=viewport content="initial-scale=1,maximum-scale=1">
<title>How to Learn Nix, Part 6: Profiles</title>
<link rel=canonical href=https://ianthehenry.com/posts/how-to-learn-nix/profiles/>
<style>:root{--box-radius:6px;--outer-box-radius:10px}:root{--content-bg:#fff;--gutter-bg:#eeeef3;--text-fg:#4d4d4c;--table-border-color:#ccc;--separator-color:#6d6d6c;--link:#07c;--link-visited:#751a9a;--blockquote-accent:var(--link);--footnote-accent:#ffd2a3;--subscribe-button-bg:#44e66c;--subscribe-button-fg:#11391b;--media-controls-on:#34b553;--media-controls-contrast:#fff;--inline-code-bg:#f3f3fa;--code-block-bg:#f3f3fa;--aside-bg:#f3f3fa;--aside-warning-bg:#fff5d1;--aside-warning-fg:#ac3233;--palette-red:#c82829;--palette-green:#718c00;--palette-yellow:#eab700;--palette-orange:#f5871f;--palette-blue:#4271ae;--palette-purple:#8959a8;--palette-teal:#3e999f;--palette-white:#fefefe;--palette-black:#000;--palette-text:var(--text-fg);--palette-dim:#8e908c;--highlight-bg:var(--palette-yellow);--highlight-fg:var(--text-fg)}#dmt::before{content:"🌖"}#dmt:hover::before{content:"🌗"}@media (prefers-color-scheme:dark){:root:not(.light-theme){--content-bg:#313233;--gutter-bg:#1d1f21;--text-fg:#d8d4cf;--table-border-color:#ccc;--separator-color:#6d6d6c;--link:rgb(82,183,255);--link-visited:rgb(193,104,229);--blockquote-accent:var(--link);--footnote-accent:#a8612f;--subscribe-button-bg:#44e66c;--subscribe-button-fg:#11391b;--media-controls-on:#44e66c;--media-controls-contrast:#11391b;--inline-code-bg:#3c4044;--code-block-bg:#1d1f21;--aside-bg:#3c4044;--aside-warning-bg:#fff5d1;--aside-warning-fg:var(--palette-red);--palette-red:#cc6666;--palette-green:#b5bd68;--palette-yellow:#f0c674;--palette-orange:#de935f;--palette-blue:#81a2be;--palette-purple:#b294bb;--palette-teal:#8abeb7;--palette-white:#fefefe;--palette-black:#000;--palette-text:var(--text-fg);--palette-dim:#969896;--highlight-bg:var(--palette-yellow);--highlight-fg:var(--palette-black)}:root:not(.light-theme) #dmt::before{content:"🌒"}:root:not(.light-theme) #dmt:hover::before{content:"🌓"}}#dmt{width:30px;text-align:right;padding-right:4px;position:absolute;top:0;bottom:0;right:0;border:none;background-color:inherit;cursor:pointer}*{margin:0;padding:0;font:inherit;box-sizing:border-box}html{background-color:var(--gutter-bg);color:var(--text-fg)}body{font-family:system-ui,sans-serif;font-size:12pt;line-height:1.8;word-wrap:break-word}body:not(.content-page) main>aside{padding:0 var(--content-padding)}body.content-page main,body:not(.content-page) article{background-color:var(--content-bg);border-radius:var(--outer-box-radius);padding:var(--content-padding)}pre{word-wrap:normal}em,i{font-style:italic}h1>a:only-child,h2>a:only-child{display:block}main .subsection-header+.post-list{margin-top:0}strong{font-weight:700}ol,ul{padding-left:3ch}hr{border-style:solid;border-width:1.5px 0 0;border-radius:1px;border-color:var(--separator-color)}:not(pre)>code{white-space:pre;background-color:var(--inline-code-bg)}li{padding-left:0}a,a:active,a:visited{text-decoration:none}a:hover{text-decoration:underline}aside{--content-padding:0.5em;padding:.5em;border-radius:var(--box-radius);background-color:var(--aside-bg)}a,a:active,header a:visited,footer a:visited,h1 a:visited{color:var(--link)}a:visited{color:var(--link-visited)}main *+p,main *+pre,main *+aside,main *+article,main *+div,main *+ul,main *+hr{margin-top:1em}main .post-header *+h1{margin-top:0}code{font-family:Menlo,monospace;padding:0 3px;border-radius:2px}pre{background-color:var(--code-block-bg);font-size:11pt;padding:calc(.75*var(--content-padding)) var(--content-padding);line-height:1.3;border-radius:var(--box-radius);overflow-x:scroll;-webkit-overflow-scrolling:touch}pre code{padding:0;border-radius:0;display:inline-block;background-color:initial}p+p{margin-top:1em}body{margin:0 auto;--content-padding:10px;max-width:768px;-webkit-text-size-adjust:100%;position:relative}header{position:relative}header>*{height:48px;line-height:48px}.promo,.promo:visited,.promo:active{display:block;text-align:center;background-color:var(--link);color:var(--code-block-bg);border-radius:0 0 var(--outer-box-radius) var(--outer-box-radius)}header .site-title{font-size:130%}header nav{position:absolute;right:30px;top:0}@media all and (max-width:400px){:root{--outer-box-radius:0}header{text-align:center}header nav{position:static}:not(pre)>code{white-space:pre-wrap}body{--content-padding:10px}#dmt{padding:0;text-align:center;width:40px}}header ul{padding:0}header li{list-style:none;display:inline-block}header a{display:block;height:100%}header li+li{margin-left:1em}footer{padding:2em 0;font-size:.85em;text-align:center}article h1.post-title{font-size:200%}article .post-title a{display:block}article .meta{font-size:90%;font-style:italic}.post-header h1{line-height:1.2em;margin-bottom:.5em}.post-footer{text-align:center}.post-footer a{display:block}ol.post-list{list-style-position:inside;padding:0}.series-rider .series-name{font-style:italic}</style>
<meta property=og:title content="How to Learn Nix, Part 6: Profiles">
<meta property=og:type content=website>
<meta property=og:url content=https://ianthehenry.com/posts/how-to-learn-nix/profiles/>
<meta name=description content="Chapter 10 describes the directory structure of ~/.nix-profile, and explains how rollbacks work.
The chapter starts with a sort of complicated drawing of multi-user directories with like default profiles and custom ones and it’s way too much for me to follow and I don’t really care. I think it’s easier to just look at some examples on my current system, and imagine how I would generalize them to multiple users.">
<meta property=og:description content="Chapter 10 describes the directory structure of ~/.nix-profile, and explains how rollbacks work.
The chapter starts with a sort of complicated drawing of multi-user directories with like default profiles and custom ones and it’s way too much for me to follow and I don’t really care. I think it’s easier to just look at some examples on my current system, and imagine how I would generalize them to multiple users.">
<meta property=og:image content=https://ianthehenry.com/checkerboard.png>
<meta name=twitter:creator content=@ianthehenry>
<meta name=twitter:card content=summary>
<link type=image/x-icon rel="shortcut icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAHH1uIDShg/xEsZv8GFk3/CSJb/wgZT/8IGU//CBlP/wkiW/8HGE7/CBlP/wkiW/8HIFX/BxhO/wcgVf8OK2t7JDhz/wcfW/8NNn7/CSpq/wkjYf8MJGP/DCJg/w02ef9SqdX/TKHJ/1my2f9Moc3/UqzV/1Cr1v9Pocf/Ditr/xk2cf8KJGL/CjR8/wwva/8RK2r/Cido/w8qa/8LLW//TqjT/1Gnz/9bsNf/Sp/K/1Wt2f9Wrtj/UKjQ/w8xc/8gPHj/Di5w/xk4ef8TL27/Dy5u/xU3fv8QLGv/Ditr/1qy3f9dttv/Yrje/0ecx/9Knsz/U6fQ/1m13f8YN3n/JjZx/wszdv8YOXz/Eilm/xc3e/8dSZT/GDJz/xk/hv9hu+P/WbHZ/1mv1v9Kn8z/WLHd/1212v9ds9n/Eipr/xcqYv8SOX3/GzRz/xQrZ/8aM3D/HEuU/xc0df8fPYD/Yrre/1603P9dt9z/VKvY/1iz4v9etNr/Y73m/xk5fP8cMm3/JEWK/xc0dP8eO3v/Hjd4/ydRnP8WM3P/Gjd3/2bA5/9dtd//Ybng/2K95v9ct+P/Ybnf/2K95/8oS5L/GChg/xxBh/8lSIz/GC5s/yM5ev8hRoz/HTp7/yE6e/9Zsdz/YLzn/2jF7v9ryfL/YLzn/1qu1f9htdz/GDyD/y0/ev9qx/X/acDn/1235v9euun/Yb3r/1665v9owu7/GUOL/yhGh/8nUJL/MkmI/yBFiP8jOHb/MVag/yM+gv8VMGv/acXx/27G7/9szv3/bMb1/2zD6/9vy/X/edf5/yBHjv8yS47/JEuO/zVLiv8nS5D/LkOB/yRXpP8lQoT/H0WI/3fS+P910Pf/b8/8/2bB7/991Pn/eNb+/3nT+P8pS5L/O1GS/ytUnP86UJH/NF2k/zNLjP8sXKv/JkCB/x4+ff+B2/3/etT9/4He//922f//fNf//3TT//991/7/NU6N/zZSkP86Zav/PlWR/zFepv88ZKb/MF2n/yQ/gf8bNXH/fd3//3/b//+K6P//ft///3vV//993f//gdz//0hWlf9FZKX/RmOj/0JXlv9IeMP/QXKz/0Jsuf8eO3z/Hjt2/3vd//+C3v//ju3//3zg//+H4v//guL//4nj//9HXp3/UGur/ztgqf9JYqP/S3G4/05ur/9EbLT/Hjt7/zNJhf+G4///heT//4rq//+E5///iOT//4jr//+G4///UXO0/09iov9EX6H/SWWn/1V5wP9Kaa7/RGSp/ydLj/8NKGCfDShg/x8+d/8RLGb/CBlP/wYWTf8GFEj/CBNH/wooZP8JIlv/CCJd/woWSf8HGE7/ByBV/wwgU/8fO3mfAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body class=content-page>
<a class=promo href=https://janet.guide/ target=_blank><i>psst, hey kid, wanna read a weird programming book</i></a>
<header>
<a class=site-title href=https://ianthehenry.com/>Ian Henry</a>
<nav>
<ul><li><a href=https://ianthehenry.com/about/>About</a><li><a href=https://ianthehenry.com/posts/>Blog</a><li><a href=https://ianthehenry.com/stuff/>Stuff</a></ul>
</nav>
<button id=dmt title="Toggle dark mode"></button>
</header>
<main>
<aside class=series-rider>
<p>This post is part of the series <a class=series-name href=https://ianthehenry.com/posts/how-to-learn-nix/>How to Learn Nix</a>, a rambling diary in which I work my way through the Nix manual in excrutiating detail.</p>
</aside>
<article class=post>
<div class=post-header>
<time class=meta datetime=2021-03-06>March 6, 2021</time>
<h1 class=post-title>
<a href=https://ianthehenry.com/posts/how-to-learn-nix/profiles/>How to Learn Nix, Part&nbsp;6:<br>Profiles</a></h1>
</div>
<div class=post-content><p><a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#sec-profiles>Chapter 10</a> describes the directory structure of <code>~/.nix-profile</code>, and explains how rollbacks work.</p>
<p>The chapter starts with a sort of complicated drawing of multi-user directories with like default profiles and custom ones and it’s way too much for me to follow and I don’t really care. I think it’s easier to just look at some examples on my current system, and imagine how I would generalize them to multiple users.</p>
<pre tabindex=0><code>$ readlink ~/.nix-profile
/nix/var/nix/profiles/per-user/ian/profile

$ readlink /nix/var/nix/profiles/per-user/ian/profile
profile-18-link

$ readlink /nix/var/nix/profiles/per-user/ian/profile-18-link
/nix/store/0hq28alc5ywci03nz2imv8rl0wv6nnyj-user-environment
</code></pre><p>That number in <code>profile-18-link</code> seems to be the way that <code>rollback</code> works – if we want to roll back, we just point the <code>profile</code> symlink to <code>profile-17-link</code>. In fact we can see everything that I’ve done so far:</p>
<pre tabindex=0><code>$ ls -l /nix/var/nix/profiles/per-user/ian
channels@ -&gt; channels-1-link
channels-1-link@ -&gt; /nix/store/98kbm9c2p7m8h1mjppvc0sam1vvkpz85-user-environment
profile@ -&gt; profile-18-link
profile-10-link@ -&gt; /nix/store/jql328aa79xk37fnj4jvikdsv1g04hp0-user-environment
profile-11-link@ -&gt; /nix/store/4n1jlahyami9rzdfgc4x1w3i1niik3r7-user-environment
profile-12-link@ -&gt; /nix/store/jql328aa79xk37fnj4jvikdsv1g04hp0-user-environment
profile-13-link@ -&gt; /nix/store/4n1jlahyami9rzdfgc4x1w3i1niik3r7-user-environment
profile-14-link@ -&gt; /nix/store/jql328aa79xk37fnj4jvikdsv1g04hp0-user-environment
profile-15-link@ -&gt; /nix/store/0hq28alc5ywci03nz2imv8rl0wv6nnyj-user-environment
profile-16-link@ -&gt; /nix/store/jql328aa79xk37fnj4jvikdsv1g04hp0-user-environment
profile-17-link@ -&gt; /nix/store/4n1jlahyami9rzdfgc4x1w3i1niik3r7-user-environment
profile-18-link@ -&gt; /nix/store/0hq28alc5ywci03nz2imv8rl0wv6nnyj-user-environment
profile-6-link@ -&gt; /nix/store/r2rlv43ijmxh56ng799zqkm471jbvr7x-user-environment
profile-7-link@ -&gt; /nix/store/2ia4kf2kbhp4888jm9sawk8gzg5b4v4r-user-environment
profile-8-link@ -&gt; /nix/store/jql328aa79xk37fnj4jvikdsv1g04hp0-user-environment
profile-9-link@ -&gt; /nix/store/4n1jlahyami9rzdfgc4x1w3i1niik3r7-user-environment
</code></pre><p>I don’t have any profiles before 6 because I did a garbage collection during the quick start guide, which cleaned them up.</p>
<p>This is very neat. We can see that not only are profiles “versioned” when we run <code>nix-env</code> commands, but channels appear to be versioned as well. We can also see that there are very few <em>unique</em> environments in this list – because I’ve mostly just been installing and uninstalling the <code>hello</code> package, which reverts me back to a version that I’ve had before. And by the virtue of content-addressed file paths, we don’t need to duplicate those user environments. Love it.</p>
<p>I had previously suspected that this involved something called the “Nix database,” but it seems like it’s just <em>names of symlinks</em>. Or maybe that’s what the manual means by “Nix database” – just the files and directories that are in <code>/nix/var</code>. I do not know yet.</p>
<p>If it is just stored on the file system, I have an unimportant question.</p>
<p>I learned previously that if I went from generation 10 to generation 1 (say), and then did something, I would create a generation 11. How does that work? Does Nix list all the files and find the biggest one? Doesn’t that mean that creating a new profile generation would use time and memory linear to the number of generations present? It could start from the current generation, and check forward until it found an empty space, since the common case is being very close to the top – that gives you constant memory, but now you’re performing a linear number of syscalls in the degenerate case, and if you ever had a sparse list you could end up with illogical numbering – so it could have a hybrid approach where– <em>none of this matters</em>. With frequent garbage collection, there is no universe in which this becomes a problem worth actually thinking about. But I’ve had to do this exact thing before in some hacky script and I always felt <em>gross</em> about it. Even though I know it doesn’t matter… it just feels like there should be some better way that I don’t know about.</p>
<p>Anyway.</p>
<p>I guess a better question is: if I switch to an earlier profile, then install something, then roll back, does it take me to the earlier profile? Or just <code>n-1</code>?</p>
<pre tabindex=0><code>$ nix-env --switch-generation 10
switching from generation 18 to 10

$ nix-env -iA nixpkgs.hello
installing 'hello-2.10'

$ nix-env --rollback
switching from generation 19 to 18
</code></pre><p>Okay. So yeah, <code>--rollback</code> is just “do the obvious simple thing.” There is no separate history; we aren’t making a DAG where new generations know what they’re based on or something. Just file names. In fact…</p>
<pre tabindex=0><code>$ nix-env --switch-generation 10
switching from generation 18 to 10

$ rm /nix/var/nix/profiles/per-user/ian/profile-15-link

$ nix-env -iA nixpkgs.hello
installing 'hello-2.10'

$ readlink $(readlink ~/.nix-profile)
profile-19-link
</code></pre><p>Huhhhh. That’s weird, right? I already had a generation 19. I rolled back to 18, then switched to ten, then made a new one… and got back to 19? Is it using like… some kind of start and length to decide what the next profile should be? I don’t know.</p>
<p>I can’t imagine this ever mattering. Let’s get back on track.</p>
<p>I look inside the profile, to see what I can see.</p>
<pre tabindex=0><code>$ tree /nix/store/0hq28alc5ywci03nz2imv8rl0wv6nnyj-user-environment
/nix/store/0hq28alc5ywci03nz2imv8rl0wv6nnyj-user-environment
├── Library -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/Library
├── bin
│&nbsp;&nbsp; ├── hello -&gt; /nix/store/pakmb65sf3g2hkbm1fdgk2fh6hiij720-hello-2.10/bin/hello
│&nbsp;&nbsp; ├── nix -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix
│&nbsp;&nbsp; ├── nix-build -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-build
│&nbsp;&nbsp; ├── nix-channel -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-channel
│&nbsp;&nbsp; ├── nix-collect-garbage -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-collect-garbage
│&nbsp;&nbsp; ├── nix-copy-closure -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-copy-closure
│&nbsp;&nbsp; ├── nix-daemon -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-daemon
│&nbsp;&nbsp; ├── nix-env -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-env
│&nbsp;&nbsp; ├── nix-hash -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-hash
│&nbsp;&nbsp; ├── nix-instantiate -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-instantiate
│&nbsp;&nbsp; ├── nix-prefetch-url -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-prefetch-url
│&nbsp;&nbsp; ├── nix-shell -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-shell
│&nbsp;&nbsp; └── nix-store -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/bin/nix-store
├── etc
│&nbsp;&nbsp; ├── profile.d -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/etc/profile.d
│&nbsp;&nbsp; └── ssl -&gt; /nix/store/ki7gssifc0xracrah8ygm63xj23wkjdz-nss-cacert-3.60/etc/ssl
├── lib -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/lib
├── libexec -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/libexec
├── manifest.nix -&gt; /nix/store/1d6n6cw1ab1qk0d4vq1hw37rlg14zpcy-env-manifest.nix
└── share
    ├── info -&gt; /nix/store/pakmb65sf3g2hkbm1fdgk2fh6hiij720-hello-2.10/share/info
    ├── man
    │&nbsp;&nbsp; ├── man1
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── hello.1.gz -&gt; /nix/store/pakmb65sf3g2hkbm1fdgk2fh6hiij720-hello-2.10/share/man/man1/hello.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-build.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-build.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-channel.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-channel.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-collect-garbage.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-collect-garbage.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-copy-closure.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-copy-closure.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-env.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-env.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-hash.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-hash.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-instantiate.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-instantiate.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-prefetch-url.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-prefetch-url.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; ├── nix-shell.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-shell.1.gz
    │&nbsp;&nbsp; │&nbsp;&nbsp; └── nix-store.1.gz -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man1/nix-store.1.gz
    │&nbsp;&nbsp; ├── man5 -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man5
    │&nbsp;&nbsp; └── man8 -&gt; /nix/store/1s7qdbi6fprms0hljsx9rq2fwr3fz1gi-nix-2.3.10-man/share/man/man8
    └── nix -&gt; /nix/store/q0z2kvkgrpvaipa87jl98qh7g5pym5fj-nix-2.3.10/share/nix
</code></pre><p>Neat.</p>
<p>I can see <code>bin</code> – that’s the directory that ultimately winds up in my <code>PATH</code>, after following this somewhat tangled web of symlinks. As well as <code>share/man</code> in my <code>MANPATH</code>. <code>etc/profile.d</code> contains <code>nix.sh</code>, which is sourced in my <code>.zshenv</code>, and <code>nix-daemon.sh</code>, which I assume is only relevant for multi-user Nix installations.</p>
<p>I tried to look at <code>manifest.nix</code> but it was not pretty printed and I don’t know how to pretty print it yet so I just gave up. <code>lib</code> seems to be what you’d guess – I recognize the string “boost” in some of the <code>.dylib</code> files. <code>Library</code> is a macOS thing; it currently contains the equivalent of a systemd unit file for the Nix daemon – again, only relevant for multi-user Nix, I think. Don’t know what <code>libexec</code> is. It contains a binary called <code>resolve-system-dependencies</code> and a symlink back to <code>bin/nix</code>. Probably not going to ever think about it.</p>
<p>The only other interesting thing in here is <code>share/nix</code>.</p>
<pre tabindex=0><code># tree /nix/store/0hq28alc5ywci03nz2imv8rl0wv6nnyj-user-environment/share/nix
/nix/store/0hq28alc5ywci03nz2imv8rl0wv6nnyj-user-environment/share/nix
├── corepkgs
│&nbsp;&nbsp; ├── buildenv.nix
│&nbsp;&nbsp; ├── config.nix
│&nbsp;&nbsp; ├── derivation.nix
│&nbsp;&nbsp; ├── fetchurl.nix
│&nbsp;&nbsp; ├── imported-drv-to-derivation.nix
│&nbsp;&nbsp; └── unpack-channel.nix
└── sandbox
    ├── sandbox-defaults.sb
    ├── sandbox-minimal.sb
    └── sandbox-network.sb
</code></pre><p>I don’t know what all this is. Are these, like, built-in Nix functions? Or I suppose… semi-built-in? I don’t know. I don’t know what these are. I could read them. But I am tired, and I do not want to read them now.</p>
<p>Lastly, I learn that I can temporarily override my <code>~/.nix-profile</code> by setting <code>nix-env --profile my/custom/path</code>. Unlike <code>--file</code>, this seems perfectly straightforward, and I will accept it without question.</p>
<hr>
<ul>
<li>How do I pretty print Nix files?</li>
<li>What are all those <code>/nix/store/...user-environment/share/nix/*.nix</code> files?</li>
</ul></div>
</article>
<div class=post-footer>
<a href="mailto:ianthehenry@gmail.com?subject=let%27s%20talk%20about%20%22Profiles%22&amp;body=First%20of%20all,%20I%20just%20wanted%20to%20say%20that%20I%20forgive%20you%20for%20not%20having%20a%20real%20comment%20system%20on%20your%20site.">comment on this post</a><a href=https://ianthehenry.com/posts/how-to-learn-nix/garbage-collection/>Next up ➜ Garbage collection</a></div>
<aside class=series-rider>
<p>
This post is part of the series <a class=series-name href=https://ianthehenry.com/posts/how-to-learn-nix/>How to Learn Nix</a>.
You can
<a target=_blank href=https://ianthehenry.com/feed.xml>subscribe to my RSS feed</a>
or
<a target=_blank href=https://twitter.com/ianthehenry>follow me on Twitter</a>
for more, or <a href=https://ianthehenry.com/posts/>peruse my back catalog</a> if you're in the mood for something different.
<div class=subsection-header>Opening remarks</div><ol start=1 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/introduction/>What's all this about?</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/prior-knowledge/>Prior knowledge</a></li>
</ol><div class=subsection-header>Reading the Nix manual</div><ol start=3 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/glossary/>What we talk about when we talk about Nix</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/quick-start-guide/>Quick starts, full hearts</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/basic-package-management/>Basic package management</a></li>
<li><strong><a href=https://ianthehenry.com/posts/how-to-learn-nix/profiles/>Profiles</a></strong>&nbsp;←&nbsp;you are here</li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/garbage-collection/>Garbage collection</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/channels/>Channels</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/sharing/>Learning to share</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-derivation/>My first derivation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/okay-my-actual-first-derivation/>Okay my actual first derivation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-language/>The Nix expression language</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations/>Derivations</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/built-in-functions/>Built-in Functions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/advanced-topics/>Advanced Topics</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/command-reference/>Command Reference</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/configuration/>Configuration</a></li>
</ol><div class=subsection-header>Interlude: in which we follow our hearts, however briefly</div><ol start=18 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-manual-reflection/>So I read the manual huh</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/switching-from-homebrew-to-nix/>Switching from Homebrew to Nix</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-nix-bug/>My first Nix bug</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-package-upgrade/>My first package upgrade</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/declarative-user-environment/>Setting up a declarative user environment</a></li>
</ol><div class=subsection-header>Reading the Nixpkgs manual</div><ol start=23 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/how-to-learn-nixpkgs/>How to learn Nixpkgs</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/overlays/>Overlays</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/overriding/>Overriding</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/an-infinite-list-of-functions/>An infinite list of functions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/even-more-functions-somehow/>Even more functions, somehow</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/the-standard-environment/>The standard environment</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations-in-detail/>Derivations in detail</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/cross-compilation/>Cross-compilation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/platform-notes/>Platform notes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/builders/>Builders</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/languages-and-frameworks/>Languages and frameworks</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/random-package-grab-bag/>Random package grab-bag</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/how-to-give-back/>How to give back</a></li>
</ol><div class=subsection-header>Documentation behind us, we set out on our own</div><ol start=36 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nixpkgs-reflection/>So I read the other manual, huh</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/saving-your-shell/>Saving your shell</a></li>
</ol><div class=subsection-header>Oh right forgot about Nix Pills</div><ol start=38 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-pills/>Nix Pills</a></li>
</ol><div class=subsection-header>Our whole lives ahead of us</div><ol start=39 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/python3-alpha/>How to install Python</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/open-questions/>Open questions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/ambiguous-packages/>Ambiguous packages</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-zshell/>Running zsh in nix-shell</a></li>
</ol><div class=subsection-header>Nix 2.4 slithers to life</div><ol start=43 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/flakes/>My first brush with flakes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/more-flakes/>More flakes, unfortunately</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/new-profiles/>Fancy new profiles</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/chipping-away-at-flakes/>Chipping away at flakes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-develop/>New and unimproved shells</a></li>
</ol>
</aside>
</main>
<footer>
© 1899-1907 <a href=https://ianthehenry.com/about/>Ian Henry</a>
</footer>
