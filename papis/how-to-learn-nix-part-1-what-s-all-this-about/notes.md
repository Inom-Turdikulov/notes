---
title: Henry How to Learn Nix
description:
tags:
- inbox
- research
created: 2023-07-17
---

Useful links:
https://github.com/jordanisaacs/dotfiles
https://codeberg.org/anriha/nixos-config/src/branch/main/configuration.nix
https://github.com/Misterio77/nix-starter-configs

https://www.linux.org.ru/news/linux-general/16881424#comments

Я использую только nix, не использую flatpak, snap, appimage и что-либо иное
вообще.

Nix дает все те же возможности что и флатпак (независимость приложений друг от
друга, возможность иметь любые зависимости индивидуально каждому приложению),
плюс - нету ненужной изоляции и контейнеров, все работает как в нормальном
линуксе, плюс - nix дает удобные инструменты разработки. Поэтому смысла при
наличии nix в системе использовать флатпак я не вижу.

Все, включая проприетарщину, установлено из репозитория.

Использую самосборное ядро - ванильное, конфиг под мое железо, накладываю патч
le9ec. Собирается автоматически при помощи Nix, обновляется автоматически.

Среда - Plasma/Wayland. Основной браузер - ungoogled chromium, работающий в
режиме чистого wayland.

Звуковая система pipewire, сконфигурированная под low-latency с использованием
rtkit.

Стандартный набор приложений из реп.

Не из реп ставится - qucs-s (слава его разработчику) и tuxguitar. Последний в
репах есть, но не работает корректно с pipewire.

Из проприетрарщины стоит Viber, Telegram, Android Studio, VS Code, дрова Nvidia.
Ставится путем перепаковки, то есть пакет для nix скачивает официальный deb или
snap, перепаковывает и помещает в /nix/store. То есть ставить в NixOS сторонний
софт, доступный только в виде deb, rpm, snap довольно тривиально.

Наибольшие проблемы со сторонним софтом - если он скачивает, либо порождает,
свои собственные бинарники. Дело в том, что обычные бинарники от нормального
линукса не будут работать в NixOS, потому что все библиотеки в /nix/store по
нестандартным путям.

Когда ставится проприетарное приложение, оно патчится утилитой patchelf, которая
прописывает прямо в бинарник пути к библиотекам в /nix/store. Но если приложение
само скачивает бинарники - (например VS Code скачивает компилятор и пытается
запускать, или Steam скачивает игры и пытается запускать :))) ) - они будут
непропатчены и не будут работать.

Для этого есть такая штука как steam-run. Она делает контейнер, внутри которого
симлинками создана стандартная файловая структура линукса, со всеми библиотеками
по стандартным путям. Чисто симлинками. И внутри этого контейнера может
запускаться любое стороннее бинарное приложение, например игры в Steam.

Я запускаю так Matlab.

/nix/store занимает у меня 30995 Мб. Там сейчас только одна, текущая версия
системы.

Обновление работает не как в обычном линуксе. Все что обновилось ставится в
/nix/store параллельно старым пакетам, поэтому после обновления занимаемое место
может практически удвоиться (!!!!). Такой ценой достигается возможность
параллельно иметь старую и обновленную систему, и не бояться отлома чего-либо
после обновления. Если сломалось - достаточно загрузиться в старую конфигурацию.

Обновления очень жирные. Надо понимать, что в NixOS не поддерживается обновление
библиотеки без обновления всего зависящего от нее. Поэтому на unstable ветке
недельные обновления весят по 30 Гб и это норма.

Время на настройку зависит от того, не столкнешься ли ты с нестандартными
проблемами. Если все ставить как есть, то это очень быстро. А если как у меня,
когда выясняется что legacy nvidia дрова есть но пакеты сломаны и вообще через
задницу написаны - то пришлось повозиться.

В завершение многобукафа всем: в текущем релизе есть и мой скромный вклад. Если
вы подключаете телефон в KDE по MTP и он работает - то вот, это я зафиксил. Не
работало.


## How to learn nix part 3

/nix/store - The location in the file system where store objects live.

